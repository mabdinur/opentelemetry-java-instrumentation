apply from: "$rootDir/gradle/java.gradle"

description = 'smoke-tests'

dependencies {
  api deps.spock
  api project(':testing-common')

  implementation project(':auto-exporters:opentelemetry-auto-exporter-logging')
  implementation deps.slf4j
  implementation deps.opentelemetryProto
  implementation "org.testcontainers:testcontainers:1.14.3"
  implementation 'com.google.protobuf:protobuf-java-util:3.12.4'
}

test {
  dependsOn = [':opentelemetry-javaagent:shadowJar', ':auto-exporters:opentelemetry-auto-exporter-logging:shadowJar']

  doFirst {
    jvmArgs "-Dio.opentelemetry.smoketest.agent.shadowJar.path=${project(':opentelemetry-javaagent').tasks.shadowJar.archivePath}"
    jvmArgs "-Dotel.exporter.jar=${project(':auto-exporters:opentelemetry-auto-exporter-logging').tasks.shadowJar.archivePath}"
  }
}